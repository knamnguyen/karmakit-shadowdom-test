"use strict";var e=require("get-promisable-result"),t=function(){return t=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},t.apply(this,arguments)};function n(e,t,n,r){return new(n||(n=Promise))((function(o,u){function i(e){try{a(r.next(e))}catch(e){u(e)}}function l(e){try{a(r.throw(e))}catch(e){u(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((r=r.apply(e,t||[])).next())}))}function r(e,t){var n,r,o,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=l(0),i.throw=l(1),i.return=l(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(l){return function(a){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(u=0)),u;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return u.label++,{value:l[1],done:!1};case 5:u.label++,r=l[1],l=[0];continue;case 7:l=u.ops.pop(),u.trys.pop();continue;default:if(!(o=u.trys,(o=o.length>0&&o[o.length-1])||6!==l[0]&&2!==l[0])){u=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){u.label=l[1];break}if(6===l[0]&&u.label<o[1]){u.label=o[1],o=l;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(l);break}o[2]&&u.ops.pop(),u.trys.pop();continue}l=t.call(e,u)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,a])}}}"function"==typeof SuppressedError&&SuppressedError;var o="$",u=":host",i="invalid selector",l=10,a=10,c=function(e){var t,n=e[0],r=e[1];return(t=n)&&(t instanceof Document||t instanceof Element||t instanceof ShadowRoot)&&"string"==typeof r};function s(e,t){return function(e){return e.split(",").map((function(e){return e.trim()}))}(e).map((function(e){var n=function(e){return e.split(o).map((function(e){return e.trim()}))}(e);return t(n)}))}function f(e,t){var n=t?" If you want to select a shadowRoot, use ".concat(t," instead."):"";return"".concat(e," cannot be used with a selector ending in a shadowRoot (").concat(o,").").concat(n)}function d(e){return e instanceof Promise?e:Promise.resolve(e)}function h(){return"You can not select a shadowRoot (".concat(o,") of the document.")}function y(){return"You can not select a shadowRoot (".concat(o,") of a shadowRoot.")}function v(e,t){for(var n,r,o=null,i=e.length,l=0;l<i;l++){if(0===l)if(e[l].length)o=t.querySelector(e[l]);else{if(t instanceof Document)throw new SyntaxError(h());if(t instanceof ShadowRoot)throw new SyntaxError(y());o=(null===(n=t.shadowRoot)||void 0===n?void 0:n.querySelector(e[++l]))||null}else o=(null===(r=o.shadowRoot)||void 0===r?void 0:r.querySelector("".concat(u," ").concat(e[l])))||null;if(null===o)return null}return o}function p(e,t){var n,r=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,u=t.length;o<u;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))}([],e,!0),o=r.pop();if(!r.length)return t.querySelectorAll(o);var i=v(r,t);return(null===(n=null==i?void 0:i.shadowRoot)||void 0===n?void 0:n.querySelectorAll("".concat(u," ").concat(o)))||null}function m(e,t){if(1===e.length&&!e[0].length){if(t instanceof Document)throw new SyntaxError(h());if(t instanceof ShadowRoot)throw new SyntaxError(y());return t.shadowRoot}var n=v(e,t);return(null==n?void 0:n.shadowRoot)||null}function g(e,t,n,r){void 0===n&&(n="querySelector"),void 0===r&&(r="shadowRootQuerySelector");for(var o=s(e,(function(e){if(!e[e.length-1].length)throw new SyntaxError(f(n,r));return e})),u=o.length,i=0;i<u;i++){var l=v(o[i],t);if(l)return l}return null}function w(e,t,n){void 0===n&&(n="querySelectorAll");for(var r=s(e,(function(e){if(!e[e.length-1].length)throw new SyntaxError(f(n));return e})),o=r.length,u=0;u<o;u++){var l=p(r[u],t);if(null==l?void 0:l.length)return l}return document.querySelectorAll(i)}function S(e,t,n,r){void 0===n&&(n="shadowRootQuerySelector"),void 0===r&&(r="querySelector");for(var u=s(e,(function(e){if(e.pop().length)throw new SyntaxError(function(e,t){return"".concat(e," must be used with a selector ending in a shadowRoot (").concat(o,"). If you don't want to select a shadowRoot, use ").concat(t," instead.")}(n,r));return e})),i=u.length,l=0;l<i;l++){var a=m(u[l],t);if(a)return a}return null}function b(t,o,u,i){return n(this,void 0,void 0,(function(){return r(this,(function(n){return[2,e.getPromisableResult((function(){return g(t,o,"asyncQuerySelector","asyncShadowRootQuerySelector")}),(function(e){return!!e}),{retries:u,delay:i,shouldReject:!1})]}))}))}function R(t,o,u,i){return n(this,void 0,void 0,(function(){return r(this,(function(n){return[2,e.getPromisableResult((function(){return w(t,o,"asyncQuerySelectorAll")}),(function(e){return!!e.length}),{retries:u,delay:i,shouldReject:!1})]}))}))}function P(t,o,u,i){return n(this,void 0,void 0,(function(){return r(this,(function(n){return[2,e.getPromisableResult((function(){return S(t,o,"asyncShadowRootQuerySelector","asyncQuerySelector")}),(function(e){return!!e}),{retries:u,delay:i,shouldReject:!1})]}))}))}var x=function(e,t){var n=e.querySelectorAll(t);if(n.length)return n;if(e instanceof Element&&e.shadowRoot){var r=x(e.shadowRoot,t);if(r.length)return r}for(var o=0,u=Array.from(e.querySelectorAll("*"));o<u.length;o++){var l=u[o],a=x(l,t);if(a.length)return a}return document.querySelectorAll(i)},_=function(t,n,r,o){return e.getPromisableResult((function(){return x(t,n)}),(function(e){return!!e.length}),{retries:r,delay:o,shouldReject:!1})};function q(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return n(this,void 0,void 0,(function(){var t,n,o,u,i;return r(this,(function(r){switch(r.label){case 0:return c(e)?(t=e[0],n=e[1],o=e[2],[4,R(n,t,(null==o?void 0:o.retries)||l,(null==o?void 0:o.delay)||a)]):[3,2];case 1:return[2,r.sent()];case 2:return u=e[0],i=e[1],[2,R(u,document,(null==i?void 0:i.retries)||l,(null==i?void 0:i.delay)||a)]}}))}))}function A(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return n(this,void 0,void 0,(function(){var t,n,o,u,i;return r(this,(function(r){switch(r.label){case 0:return c(e)?(t=e[0],n=e[1],o=e[2],[4,P(n,t,(null==o?void 0:o.retries)||l,(null==o?void 0:o.delay)||a)]):[3,2];case 1:return[2,r.sent()];case 2:return u=e[0],i=e[1],[2,P(u,document,(null==i?void 0:i.retries)||l,(null==i?void 0:i.delay)||a)]}}))}))}var Q=function(){function e(e,n){e instanceof Node||e instanceof Promise?(this._element=e,this._asyncParams=t({retries:l,delay:a},n||{})):(this._element=document,this._asyncParams=t({retries:l,delay:a},e||{}))}return Object.defineProperty(e.prototype,"element",{get:function(){return d(this._element).then((function(e){return e instanceof NodeList?e[0]||null:e}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"$",{get:function(){var t=this;return new e(d(this._element).then((function(e){return e instanceof Document||e instanceof ShadowRoot||null===e||e instanceof NodeList&&0===e.length?null:e instanceof NodeList?A(e[0],o,t._asyncParams):A(e,o,t._asyncParams)})),this._asyncParams)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"all",{get:function(){return d(this._element).then((function(e){return e instanceof NodeList?e:document.querySelectorAll(i)}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"asyncParams",{get:function(){return this._asyncParams},enumerable:!1,configurable:!0}),e.prototype.eq=function(e){return n(this,void 0,void 0,(function(){return r(this,(function(t){return[2,d(this._element).then((function(t){return t instanceof NodeList&&t[e]||null}))]}))}))},e.prototype.query=function(t){var n=this;return new e(d(this._element).then((function(e){return null===e||e instanceof NodeList&&0===e.length?null:e instanceof NodeList?q(e[0],t,n._asyncParams):q(e,t,n._asyncParams)})),this._asyncParams)},e.prototype.deepQuery=function(t){var n=this;return new e(d(this._element).then((function(e){return null===e||e instanceof NodeList&&0===e.length?null:e instanceof NodeList?Promise.race(Array.from(e).map((function(e){return _(e,t,n._asyncParams.retries,n._asyncParams.delay)}))):_(e,t,n._asyncParams.retries,n._asyncParams.delay)})),this._asyncParams)},e}();exports.AsyncSelector=Q,exports.asyncDeepQuerySelector=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return n(this,void 0,void 0,(function(){var t,n,o,u,i;return r(this,(function(r){switch(r.label){case 0:return c(e)?(t=e[0],n=e[1],o=e[2],[4,_(t,n,(null==o?void 0:o.retries)||l,(null==o?void 0:o.delay)||a)]):[3,2];case 1:case 3:return[2,r.sent()[0]||null];case 2:return u=e[0],i=e[1],[4,_(document,u,(null==i?void 0:i.retries)||l,(null==i?void 0:i.delay)||a)]}}))}))},exports.asyncDeepQuerySelectorAll=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(c(e)){var n=e[0],r=e[1],o=e[2];return _(n,r,(null==o?void 0:o.retries)||l,(null==o?void 0:o.delay)||a)}var u=e[0],i=e[1];return _(document,u,(null==i?void 0:i.retries)||l,(null==i?void 0:i.delay)||a)},exports.asyncQuerySelector=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return n(this,void 0,void 0,(function(){var t,n,o,u,i;return r(this,(function(r){switch(r.label){case 0:return c(e)?(t=e[0],n=e[1],o=e[2],[4,b(n,t,(null==o?void 0:o.retries)||l,(null==o?void 0:o.delay)||a)]):[3,2];case 1:case 3:return[2,r.sent()];case 2:return u=e[0],i=e[1],[4,b(u,document,(null==i?void 0:i.retries)||l,(null==i?void 0:i.delay)||a)]}}))}))},exports.asyncQuerySelectorAll=q,exports.asyncShadowRootQuerySelector=A,exports.deepQuerySelector=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e[0],r=e[1];return"string"==typeof n?x(document,n)[0]||null:x(n,r)[0]||null},exports.deepQuerySelectorAll=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e[0],r=e[1];return"string"==typeof n?x(document,n):x(n,r)},exports.querySelector=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e[0],r=e[1];return"string"==typeof n?g(n,document):g(r,n)},exports.querySelectorAll=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e[0],r=e[1];return"string"==typeof n?w(n,document):w(r,n)},exports.shadowRootQuerySelector=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e[0],r=e[1];return"string"==typeof n?S(n,document):S(r,n)};
